<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>George's –°—É–≤–µ–Ω–∏—Ä—ã</title>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #ff85a2;
      --accent-soft: #fbb6ce;
      --bg-gradient: linear-gradient(135deg, #fff5f7 0%, #f0efff 100%);
      --card-bg: rgba(255, 255, 255, 0.9);
      --text: #5c4d61;
      --shadow: 0 10px 25px rgba(255, 133, 162, 0.15);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Comfortaa', cursive;
      background: var(--bg-gradient);
      background-attachment: fixed;
      color: var(--text);
      margin: 0;
      padding: 15px;
      min-height: 100vh;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    header { text-align: center; margin-bottom: 20px; }
    h1 { font-size: 26px; color: #d63384; margin: 10px 0; }

    .btn-glass {
      background: var(--card-bg);
      border: 2px solid var(--accent-soft);
      color: var(--accent);
      padding: 12px;
      border-radius: 20px;
      width: 100%;
      font-weight: 700;
      margin-bottom: 15px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-glass:active { transform: scale(0.96); background: var(--accent-soft); color: white; }

    .card {
      background: var(--card-bg);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 25px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      border: 1px solid rgba(255,255,255,0.5);
    }

    .search-box { margin-bottom: 15px; position: relative; }
    .search-input {
      width: 100%;
      padding: 12px 15px 12px 40px;
      border-radius: 18px;
      border: 1px solid var(--accent-soft);
      outline: none;
      font-family: inherit;
      background: rgba(255,255,255,0.8);
    }
    .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 14px; opacity: 0.5; }

    form { display: grid; gap: 12px; }
    input {
      padding: 14px;
      border: 1px solid #eee;
      border-radius: 15px;
      font-family: inherit;
      outline: none;
      background: #fff;
    }

    .btn-add {
      background: linear-gradient(90deg, #ff85a2, #ff99ac);
      color: white;
      border: none;
      padding: 14px;
      border-radius: 15px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
    }

    .item-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px dashed #eee;
      animation: slideIn 0.3s ease-out forwards;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .item-info b { font-size: 16px; display: block; margin-bottom: 2px; }
    .item-info .qty-text { font-size: 13px; color: var(--text); font-weight: 600; }
    .item-info .date-text { font-size: 10px; color: #aaa; display: block; margin-top: 4px; }

    .price-badge {
      background: #fff0f3;
      color: #d63384;
      padding: 5px 10px;
      border-radius: 12px;
      font-weight: 700;
      margin-right: 10px;
    }

    .actions { display: flex; gap: 8px; }
    .btn-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .btn-sell-mini { background: #e6fffa; color: #38b2ac; }
    .btn-del-mini { background: #fff5f5; color: #feb2b2; }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(92, 77, 97, 0.4);
      backdrop-filter: blur(5px);
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 30px;
      width: 100%;
      max-width: 380px;
      text-align: center;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ */
    .history-item {
      padding: 12px 0;
      border-bottom: 1px solid #f9f9f9;
      font-size: 13px;
    }
    .history-flow {
      background: #fdf2f8;
      padding: 6px 10px;
      border-radius: 10px;
      display: inline-block;
      margin-top: 5px;
      font-size: 11px;
      color: #d63384;
    }
    .history-flow b { color: #5c4d61; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>‚ú® —É –∫–æ–º–∞–Ω–¥–∏—Ä–∞ –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø–∞—Ä–æ–ª—å üê∞ ‚ú®</h1>
  </header>

  <button class="btn-glass" onclick="openHistory()">üíï –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂</button>

  <div class="card">
    <form id="itemForm">
      <input id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å—É–≤–µ–Ω–∏—Ä–∞" required>
      <div style="display: flex; gap: 10px;">
        <input id="quantity" type="number" min="0" placeholder="–ö–æ–ª-–≤–æ" style="width: 40%;" required>
        <input id="price" type="number" min="0" step="1" placeholder="–¶–µ–Ω–∞ (÷è)" style="width: 60%;">
      </div>
      <button type="submit" class="btn-add">‚ú® –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    </form>
  </div>

  <div class="search-box">
    <span class="search-icon">üîç</span>
    <input type="text" id="searchInput" class="search-input" placeholder="–ù–∞–π—Ç–∏ —Å—É–≤–µ–Ω–∏—Ä..." oninput="render()">
  </div>

  <div class="card" id="itemsList"></div>
</div>

<div id="sellPopup" class="modal"><div class="modal-content">
  <h3 id="sellTitle">–°–ø–∏—Å–∞—Ç—å</h3>
  <input id="sellQty" type="number" min="1" value="1" style="width:100%; text-align:center; margin-bottom:15px; border:1px solid #eee; border-radius:10px; padding:10px;">
  <button class="btn-add" onclick="confirmSell()" style="width:100%">–°–ø–∏—Å–∞—Ç—å</button>
  <button onclick="closeModal('sellPopup')" style="background:none; border:none; color:#aaa; margin-top:15px;">–û—Ç–º–µ–Ω–∞</button>
</div></div>

<div id="historyPopup" class="modal"><div class="modal-content" style="max-width: 450px;">
  <h3>üíñ –ü—Ä–æ–¥–∞–∂–∏</h3>
  <div id="historyTable" style="max-height: 350px; overflow-y: auto; text-align: left;"></div>
  <div style="margin-top:15px; font-weight:700; color:#d63384; font-size: 18px;">–ò—Ç–æ–≥–æ: <span id="historyTotal">0</span> ÷è</div>
  <button class="btn-add" onclick="closeModal('historyPopup')" style="width:100%; margin-top:20px">–ó–∞–∫—Ä—ã—Ç—å</button>
</div></div>

<script>
let items = JSON.parse(localStorage.getItem('souvenirs_v5')) || [];
let sales = JSON.parse(localStorage.getItem('sales_v5')) || [];
let currentIdx = null;

const save = () => localStorage.setItem('souvenirs_v5', JSON.stringify(items));
const saveSales = () => localStorage.setItem('sales_v5', JSON.stringify(sales));

function render() {
  const container = document.getElementById('itemsList');
  const query = document.getElementById('searchInput').value.toLowerCase();
  
  const filtered = items.map((item, originalIndex) => ({...item, originalIndex}))
                        .filter(item => item.name.toLowerCase().includes(query));

  container.innerHTML = filtered.length ? '' : '<p style="text-align:center; color:#ccc; font-size:13px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ...</p>';
  
  filtered.forEach((item) => {
    container.innerHTML += `
      <div class="item-row">
        <div class="item-info">
          <b>${item.name}</b>
          <span class="qty-text">–û—Å—Ç–∞—Ç–æ–∫: ${item.quantity} —à—Ç.</span>
          <span class="date-text">–î–æ–±–∞–≤–ª–µ–Ω: ${item.addedAt || '—Ä–∞–Ω–µ–µ'}</span>
        </div>
        <div class="actions">
          <span class="price-badge">${item.price} ÷è</span>
          <button class="btn-circle btn-sell-mini" onclick="openSell(${item.originalIndex})">üí∏</button>
          <button class="btn-circle btn-del-mini" onclick="deleteItem(${item.originalIndex})">‚úï</button>
        </div>
      </div>
    `;
  });
}

function openSell(idx) {
  currentIdx = idx;
  document.getElementById('sellTitle').innerText = items[idx].name;
  document.getElementById('sellQty').value = 1;
  document.getElementById('sellPopup').style.display = 'flex';
}

function confirmSell() {
  const qty = +document.getElementById('sellQty').value;
  const item = items[currentIdx];
  
  if (qty > 0 && qty <= item.quantity) {
    const before = item.quantity;
    item.quantity -= qty;
    const after = item.quantity;

    sales.unshift({ 
      name: item.name, 
      qty, 
      before,
      after,
      total: qty * item.price, 
      date: new Date().toLocaleString([], {day: '2-digit', month: '2-digit', hour: '2-digit', minute:'2-digit'}) 
    });

    save(); saveSales(); render(); closeModal('sellPopup');
  } else { alert('–û—à–∏–±–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞!'); }
}

function openHistory() {
  let total = 0;
  document.getElementById('historyTable').innerHTML = sales.map(s => {
    total += s.total;
    return `
      <div class="history-item">
        <div style="display:flex; justify-content:space-between">
          <b>${s.name}</b>
          <span style="font-weight:700">${s.total} ÷è</span>
        </div>
        <div class="history-flow">
          –ë—ã–ª–æ: <b>${s.before}</b> ‚Üí –ü—Ä–æ–¥–∞–Ω–æ: <b>${s.qty}</b> ‚Üí –°—Ç–∞–ª–æ: <b>${s.after}</b>
        </div>
        <div style="margin-top:4px"><small style="color:#ccc">${s.date}</small></div>
      </div>`;
  }).join('');
  document.getElementById('historyTotal').innerText = total;
  document.getElementById('historyPopup').style.display = 'flex';
}

function deleteItem(idx) {
  if(confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –Ω–∞–≤—Å–µ–≥–¥–∞?')) { items.splice(idx, 1); save(); render(); }
}

function closeModal(id) { document.getElementById(id).style.display = 'none'; }

document.getElementById('itemForm').onsubmit = e => {
  e.preventDefault();
  const now = new Date();
  const timeStr = now.toLocaleDateString([], {day: '2-digit', month: '2-digit'}) + ' ' + now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
  
  items.push({
    name: document.getElementById('name').value,
    quantity: +document.getElementById('quantity').value,
    price: +document.getElementById('price').value || 0,
    addedAt: timeStr
  });
  save(); render(); e.target.reset();
};

render();
</script>

</body>
</html>